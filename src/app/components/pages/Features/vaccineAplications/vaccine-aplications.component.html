<header class="bg-white shadow-md py-4">
    <div class="w-full px-4">
      <h1 class="text-3xl font-extrabold text-blue-900 dark:text-blue-400 md:text-4xl">
        <span class="bg-gradient-to-r from-sky-400 to-blue-600 bg-clip-text text-transparent">
            ➡︎ Lista de Vacunas Aplicadas
        </span>
      </h1>
    </div>
  </header>
  
  <div class="container mx-auto my-6 p-4 bg-white shadow-md rounded-lg">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold">Lista de Vacunas Aplicadas</h2>
        <button class="bg-green-500 hover:bg-green-600 text-white font-bold py-2.5 px-4 rounded flex items-center text-base" (click)="openModal()">
          <i class="fas fa-plus mr-2"></i> Agregar Aplicación
        </button>      
    </div>
  
    <!-- Switcher de Estado -->
    <div class="flex items-center mb-4">
        <span class="mr-2 font-semibold">Mostrar:</span>
        <label class="relative inline-flex items-center cursor-pointer">
            <input type="checkbox" class="sr-only peer" [(ngModel)]="activeActive" (ngModelChange)="toggleActive($event)">
            <div class="w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-5 peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div>
            <span class="ml-3 text-sm font-medium text-gray-900">
                {{ activeFilter === 'A' ? 'Activos' : 'Inactivos' }}
            </span>
        </label>
    </div>
  
    <!-- Tabla de aplicaciones -->
    <table class="min-w-full text-center border-separate" style="border-spacing: 0 10px;">
      <thead>
        <tr>
          <th class="px-6 py-3 text-lg font-semibold text-blue-900 bg-blue-100 rounded-tl-lg">Vacuna</th>
          <th class="px-6 py-3 text-lg font-semibold text-blue-900 bg-blue-100">Galpón</th>
          <th class="px-6 py-3 text-lg font-semibold text-blue-900 bg-blue-100">Fecha de Aplicación</th>
          <th class="px-6 py-3 text-lg font-semibold text-blue-900 bg-blue-100">Edad S/D</th>
          <th class="px-6 py-3 text-lg font-semibold text-blue-900 bg-blue-100">Fecha de Registro</th>
          <th class="px-6 py-3 text-lg font-semibold text-blue-900 bg-blue-100">Cantidad</th>
          <th class="px-6 py-3 text-lg font-semibold text-blue-900 bg-blue-100">Costo</th>
          <th class="px-6 py-3 text-lg font-semibold text-blue-900 bg-blue-100">Cantidad Gallinas</th>
          <th class="px-6 py-3 text-lg font-semibold text-blue-900 bg-blue-100">Correo Electrónico</th>
          <th class="px-6 py-3 text-lg font-semibold text-blue-900 bg-blue-100">Total</th>
          <th class="px-6 py-3 text-lg font-semibold text-blue-900 bg-blue-100 rounded-tr-lg">Estado</th>
          <th class="px-6 py-3 text-lg font-semibold text-blue-900 bg-blue-100 rounded-tr-lg">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let application of filteredApplications">
          <td class="px-6 py-4 bg-gray-100">{{ getNameIto(application.cycleLifeId, application) }}</td>
          <td class="px-6 py-4 bg-gray-100">{{ getShedName(application.shedId) }}</td>
          <td class="px-6 py-4 bg-gray-100">{{ formatDate(application.endDate) }}</td>
          <td class="px-6 py-4 bg-gray-100">{{ application.times }}</td>
          <td class="px-6 py-4 bg-gray-100">{{ formatDate(application.dateRegistration) }}</td>
          <td class="px-6 py-4 bg-gray-100">{{ application.amount }}</td>
          <td class="px-6 py-4 bg-gray-100">{{ application.costApplication }}</td>
          <td class="px-6 py-4 bg-gray-100">{{ application.quantityBirds }}</td>
          <td class="px-6 py-4 bg-gray-100">{{ application.email }}</td>
          <td class="px-6 py-4 bg-gray-100">{{ calculateTotal(application.costApplication, application.quantityBirds) | number:'1.2-2' }}</td>
          <td class="px-6 py-4 bg-gray-100">{{ application.active === 'A' ? 'Activo' : 'Inactivo' }}</td>
          <td class="px-6 py-4 bg-gray-100">
            <button *ngIf="application.active === 'A'" class="bg-yellow-500 text-white px-3 py-1 rounded mr-2" (click)="editApplicationDetails(application)">Editar</button>
            <button *ngIf="application.active === 'A'" class="bg-red-500 text-white px-3 py-1 rounded" (click)="inactivateApplication(application.applicationId)">Eliminar</button>
            <button *ngIf="application.active === 'I'" class="bg-green-500 text-white px-3 py-1 rounded mr-2" (click)="activateApplication(application.applicationId)">Restaurar</button>
          </td>
        </tr>
      </tbody>  
    </table>
  
    <!-- Estado de carga -->
    <div *ngIf="isLoading" class="text-center mt-4">
      <p>Cargando aplicaciones de vacunas...</p>
    </div>
  </div>
  
  <!-- Modal para agregar/editar aplicación --> 
  <div *ngIf="isModalOpen" class="fixed inset-0 flex items-center justify-center z-50">
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" (click)="closeModal()"></div>
  
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-xl max-h-[90vh] overflow-y-auto m-4 relative">
      <div class="flex justify-between items-center p-4 border-b dark:border-gray-700">
        <h2 class="text-xl font-bold">{{ isEditMode ? 'Editar Aplicación' : 'Agregar Aplicación' }}</h2>
        <button type="button" class="text-gray-500 hover:text-gray-700" (click)="closeModal()">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18M6 6l12 12"/></svg>
        </button>
      </div>
  
      <form (ngSubmit)="isEditMode ? updateApplication() : addApplication()" class="p-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          
          <!-- Vacuna -->
          <div>
            <label class="block text-sm font-medium mb-1" for="cycleLifeId">Vacuna *</label>
            <select class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700" 
              id="cycleLifeId" [(ngModel)]="applicationForm.cycleLifeId" name="cycleLifeId" required>
              <option value="" disabled selected>Seleccionar vacuna</option>
              <option *ngFor="let cycleLife of cycleLifes" [value]="cycleLife.id">{{ cycleLife.nameIto }}</option>
            </select>
          </div>
  
          <!-- Galpón -->
          <div>
            <label class="block text-sm font-medium mb-1" for="shedId">Galpón *</label>
            <select class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700" 
              id="shedId" [(ngModel)]="applicationForm.shedId" name="shedId" required>
              <option value="" disabled selected>Seleccionar galpón</option>
              <option *ngFor="let shed of sheds" [value]="shed.id">{{ shed.name}}</option>
            </select>
          </div>
  
          <!-- Fecha de Registro -->
          <div>
            <label class="block text-sm font-medium mb-1" for="dateRegistration">Fecha de Registro *</label>
            <input type="date" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700" 
              id="dateRegistration" [(ngModel)]="applicationForm.dateRegistration" name="dateRegistration" required />
          </div>
  
          <!-- Cantidad -->
          <div>
            <label class="block text-sm font-medium mb-1" for="amount">Cantidad *</label>
            <input type="number" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700" 
              id="amount" [(ngModel)]="applicationForm.amount" name="amount" min="0" required />
          </div>
  
          <!-- Costo -->
          <div>
            <label class="block text-sm font-medium mb-1" for="costApplication">Costo *</label>
            <input type="number" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700" 
              id="costApplication" [(ngModel)]="applicationForm.costApplication" name="costApplication" min="0" required />
          </div>
  
          <!-- Cantidad de Gallinas -->
          <div>
            <label class="block text-sm font-medium mb-1" for="quantityBirds">Cantidad Gallinas *</label>
            <input type="number" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700" 
              id="quantityBirds" [(ngModel)]="applicationForm.quantityBirds" name="quantityBirds" min="0" required />
          </div>
  
          <!-- Correo Electrónico -->
          <div>
            <label class="block text-sm font-medium mb-1" for="email">Correo Electrónico *</label>
            <input type="email" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700" 
              id="email" [(ngModel)]="applicationForm.email" name="email" required />
          </div>
        </div>
  
        <div class="flex justify-end mt-4">
          <button type="button" class="bg-gray-500 text-white px-4 py-2 rounded-md mr-2" (click)="closeModal()">Cancelar</button>
          <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-md">{{ isEditMode ? 'Actualizar' : 'Guardar' }}</button>
        </div>
      </form>
    </div>
  </div>
  
  
  <!-- Paginador -->
  <div class="flex justify-center mt-4 space-x-2">
    <button 
        class="px-3 py-2 bg-gray-300 rounded-md text-sm font-semibold hover:bg-gray-400 disabled:opacity-50"
        [disabled]="currentPage === 1"
        (click)="cambiarPagina(currentPage - 1)">
        Anterior
    </button>
  
    <button 
        *ngFor="let page of getPages()"
        class="px-3 py-2 rounded-md text-sm font-semibold"
        [ngClass]="{'bg-blue-500 text-white': currentPage === page, 'bg-gray-200 hover:bg-gray-300': currentPage !== page}"
        (click)="cambiarPagina(page)">
        {{ page }}
    </button>
    
    <button 
        class="px-3 py-2 bg-gray-300 rounded-md text-sm font-semibold hover:bg-gray-400 disabled:opacity-50"
        [disabled]="currentPage === getPages().length"
        (click)="cambiarPagina(currentPage + 1)">
        Siguiente
    </button>
  </div>
  